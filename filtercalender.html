<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Full Calendar Example</title>
    <!--bootstrap4 cdn-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link href="./Assets/lib/main.css" rel="stylesheet" />
    <script src="./Assets/lib/main.js"></script>
    <link href="/Assets/Style.css" rel="stylesheet" />
    <!--react cdn-->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!--moment cdn-->
    <script src=" https://MomentJS.com/downloads/moment.js"></script>
    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div class="container-fluid h-100">
      <div class="row h-100">
        <!-- left sidebar -->
        <div class="col-md-2 fixed pl-0 py-2 bg-light left">
          <ul class="nav flex-md-column flex-nowrap justify-content-center">
            <li class="nav-item">
              <a class="nav-link text-truncate" href="#"
                >Full Calendars Examples
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./index.html">Simple Cal. Example</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./index2.html"
                >Resource Time-Grid Cal. Example</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./index3.html"
                >Resource TimeLine Cal.Example</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./index4.html"
                >Generate Dynamic Cal. Example</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./filtercalender.html"
                >Filter Calender Example</a
              >
            </li>
          </ul>
        </div>
        <!-- center content -->
        <div class="invisible col-md-2 fixed">
          <!--ghost div to push middle section offset-->
        </div>
        <div class="col fluid d-flex flex-column p-0">
          <nav
            id="topNav"
            class="navbar navbar-expand-md fixed-top"
            style="background-color: #deedfb"
          >
            <div class="collapse navbar-collapse" id="collapsingNavbar">
              <ul class="nav navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="#">Full Calendar Example</a>
                </li>
              </ul>
              <ul class="nav navbar-nav ml-auto">
                <li class="nav-item">
                  <a
                    class="nav-link page-scroll"
                    data-toggle="modal"
                    title="A free Bootstrap theme"
                    href="#aboutModal"
                    >About</a
                  >
                </li>
              </ul>
            </div>
          </nav>

          <!-- main content -->
          <div class="flex-grow">
            <div class="col-12 mb-4" style="margin-top: 50px">
              <div id="root"></div>
            </div>
          </div>
          <!-- /main content -->
          <footer
            class="navbar navbar-expand"
            style="background-color: #deedfb"
          >
            <ul class="navbar-nav">
              <li class="nav-item">
                <a href="#" class="nav-link"
                  >Designed by : Shubham kUmar jaiswal</a
                >
              </li>
              <li class="nav-item"><a href="#" class="nav-link">Link1</a></li>
              <li class="nav-item"><a href="#" class="nav-link">Link2</a></li>
              <li class="nav-item">
                <a href="#" class="nav-link">More links</a>
              </li>
            </ul>
          </footer>
        </div>
      </div>
    </div>
    <script type="text/babel">
      //our available resources
      const resources = [
        {
          id: "a",
          title: "ROOM A",
          avldatetime: {
            start_date: "2022-12-01 09:00:00",
            end_date: "2023-01-01 19:00:00",
          },
        },
      ];
      //console.log(resources);

      //our generate dynamically event data
      const title = "C++ Session";
      const start_date = "2022-12-01 09:00:00";
      const end_date = "2023-01-01 12:00:00";
      const backgroundColor = "#075db3";
      const color = "#075db3";
      const borderColor = "#075db3";

      var startDate = moment(start_date).format("YYYY-MM-DD");
      var endDate = moment(end_date).format("YYYY-MM-DD");
      var startTime = moment(start_date).format("hh:mm:ss");
      var endTime = moment(end_date).format("hh:mm:ss");

      //get total days between two dates
      function getNumberOfDays(start, end) {
        const date1 = new Date(start);
        const date2 = new Date(end);
        const oneDay = 1000 * 60 * 60 * 24;
        const diffInTime = date2.getTime() - date1.getTime();
        const diffInDays = Math.round(diffInTime / oneDay);
        return diffInDays;
      }
      const days = getNumberOfDays(startDate, endDate);
      const eventsession1 = [];
      for (var i = 1; i <= days; i++) {
        eventsession1.push({
          id: i,
          title: "C++ Session",
          resourceId: "a",
          start: getstartdate("2022-12-" + i) + " " + "09:00:00",
          end: getenddate("2022-12-" + i) + " " + "12:00:00",
          eventtimeslots: gettimeslots(startTime, endTime),
          backgroundColor: backgroundColor,
          color: color,
          borderColor: borderColor,
        });
      }

      const start_date1 = "2022-12-01 14:00:00";
      const end_date1 = "2023-01-01 15:00:00";
      const backgroundColor1 = "#075db3";
      const color1 = "#075db3";
      const borderColor1 = "#075db3";
      var startDate1 = moment(start_date1).format("YYYY-MM-DD");
      var endDate1 = moment(end_date1).format("YYYY-MM-DD");
      var startTime1 = moment(start_date1).format("hh:mm:ss");
      var endTime1 = moment(end_date1).format("hh:mm:ss");
      const eventsession2 = [];
      for (var i = 1; i <= days; i++) {
        eventsession2.push({
          id: i,
          title: "C++ Session",
          resourceId: "a",
          start: getstartdate("2022-12-" + i) + " " + "14:00:00",
          end: getenddate("2022-12-" + i) + " " + "15:00:00",
          eventtimeslots: gettimeslots(startTime1, endTime1),
          backgroundColor: backgroundColor1,
          color: color1,
          borderColor: borderColor1,
        });
      }
      const result = eventsession1.concat(eventsession2);
      // const result = eventsession1;
      console.log(result);

      //fn for get start date format
      function getstartdate(start_date) {
        var currDate = new Date(start_date);
        return moment(currDate.setDate(currDate.getDate() + 1)).format(
          "YYYY-MM-DD"
        );
      }
      //fn for get end date format
      function getenddate(end_date) {
        var currDate = new Date(end_date);
        return moment(currDate.setDate(currDate.getDate() + 1)).format(
          "YYYY-MM-DD"
        );
      }
      //time slots
      function addMinutes(time, minutes) {
        var date = new Date(
          new Date("01/01/2015 " + time).getTime() + minutes * 60000
        );
        var tempTime =
          (date.getHours().toString().length == 1
            ? "0" + date.getHours()
            : date.getHours()) +
          ":" +
          (date.getMinutes().toString().length == 1
            ? "0" + date.getMinutes()
            : date.getMinutes()) +
          ":" +
          (date.getSeconds().toString().length == 1
            ? "0" + date.getSeconds()
            : date.getSeconds());
        return tempTime;
      }

      function gettimeslots(start_time, end_time) {
        var starttime = start_time;
        var interval = "30";
        var endtime = end_time;
        var timeslots = [starttime];

        while (starttime != endtime) {
          starttime = addMinutes(starttime, interval);
          timeslots.push(starttime);
        }

        const perChunk = 2; // items per chunk
        const inputArray = timeslots;
        const results = inputArray.reduce((resultArray, item, index) => {
          const chunkIndex = Math.floor(index / perChunk);
          if (!resultArray[chunkIndex]) {
            resultArray[chunkIndex] = []; // start a new chunk
          }
          resultArray[chunkIndex].push(item);

          return resultArray;
        }, []);
        const mytimeslots = [];
        const lgh = results.length;
        results.slice(0, lgh - 1).map((items, key) => {
          mytimeslots.push({
            start_time: items[0],
            end_time: items[1],
            eventtitle: "session",
          });
        });

        return mytimeslots;
      }

      //################################## test ########################################3
      var sdate = new Date(startDate);
      //console.log(sdate);
      var edate = new Date(endDate);
      // console.log(edate);

      function checkGoogleCalendarConflict(date) {
        var hasConflict = false;
        return hasConflict;
      }

      function getTimeSlotsForDay(date) {
        var timeSlots = [];
        var dayStart = new Date(date);
        var dayEnd = new Date(date);

        switch (date.getDay()) {
          case 0: //Sunday
            return timeSlots;
          case 6: //Saturday
            dayStart.setHours(10, 0, 0, 0);
            dayEnd.setHours(20, 0, 0, 0);
            break;
          default:
            dayStart.setHours(13, 0, 0, 0);
            dayEnd.setHours(20, 0, 0, 0);
        }
        do {
          if (!checkGoogleCalendarConflict(dayStart)) {
            timeSlots.push(new Date(dayStart));
          }
          dayStart.setHours(dayStart.getHours(), dayStart.getMinutes() + 30);
        } while (dayStart < dayEnd);

        return timeSlots;
      }

      var message = "";
      for (var i = new Date(sdate); i < edate; i.setDate(i.getDate() + 1)) {
        message += i.toDateString() + ":\n";
        message +=
          getTimeSlotsForDay(i)
            .map(function (it) {
              return it.toTimeString();
            })
            .join(",\n") + "\n";
      }
      // console.log(message);

      //################################## test ########################################3

      class Application extends React.Component {
        render() {
          return (
            <div>
              <Calendar />
            </div>
          );
        }
      }

      class Calendar extends React.Component {
        constructor() {
          super();
          this.state = {
            date: new Date(),
            eventdata: result,
            resources: resources,
          };
        }

        componentDidMount() {
          var calendarEl = document.getElementById("calendar");
          var calendar = new FullCalendar.Calendar(calendarEl, {
            schedulerLicenseKey: "GPL-My-Project-Is-Open-Source",
            aspectRatio: 2.7,
            initialDate: moment(this.state.date).format("YYYY-MM-DD"),
            headerToolbar: {
              left: "promptResource promptResource1 today prev,next",
              center: "title",
              right: "dayGridMonth,resourceTimelineDay,timeGridWeek,listWeek",
            },
            customButtons: {
              promptResource: {
                text: "filter",
                click: function () {
                  calendar.changeView("timeGridDay");
                },
              },
              promptResource1: {
                text: "default",
                click: function () {
                  calendar.changeView("resourceTimelineDay");
                },
              },
            },
            expandRows: true,
            resourceAreaHeaderContent: "Available Rooms",
            initialView: "dayGridMonth",
            events: this.state.eventdata,
            resources: this.state.resources,
            expandRows: true,
          });

          calendar.render();
        }

        render() {
          return (
            <>
              <div id="calendar"></div>
            </>
          );
        }
      }
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<Application />);
    </script>
    <!--
      Note: this page is a great way to try React but it's not suitable for production.
      It slowly compiles JSX with Babel in the browser and uses a large development build of React.

      Read this section for a production-ready setup with JSX:
      https://reactjs.org/docs/add-react-to-a-website.html#add-jsx-to-a-project

      In a larger project, you can use an integrated toolchain that includes JSX instead:
      https://reactjs.org/docs/create-a-new-react-app.html

      You can also use React without JSX, in which case you can remove Babel:
      https://reactjs.org/docs/react-without-jsx.html
    -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
